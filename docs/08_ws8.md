# Workshop 8: Factorial ANOVA: Different Designs and Assumptions

**Aims:**

-   Practice importing and wrangling data ready for analysis.
-   Practice running a mixed ANOVA, including interpreting the model and running and follow-up analyses.
-   Practice evaluating model assumptions.
-   Practice generating plots and writing-up the analysis.

**Introduction**

This week's workshop is going to bring together several things you have covered so far during PS2010, including right back to the week one workshop. Today you are going to analyse a data set starting from a "messy" data set right the way through to producing some fancy data visualisations to show off your findings.

All of the steps covered in today's workshop could be helpful for your lab report analysis and write-up.

There are quite a few steps today and so don't worry if you cannot complete them all in the allotted time, but instead save your script and use your independent study time to complete it.

**Today's Research Scenario**

There are lots of tasks where our performance can be negatively impacted by distractions. There are some tasks whereby we should solely focus on what we are doing, for example, when completing this workshop or driving a car.

If you are distracted completing this workshop, the worst that could happen is that you make a mistake with your code. Distractions when driving can have much more serious consequences. Today's research question is: How do distractions impact our ability to detect different types of hazards when driving.

Sixty experienced drivers (minimum 1 year driving experience) were recruited to take part in a driving simulation task, whereby they had to identify different hazards. Participants were first randomly allocated to one of two conditions.

-   Independent variable 1 (distraction yes/no):

    -   Yes: participants were required to answer questions by the researcher via a hands free headset whilst in the simulator.

    -   No: participants were left to drive uninterrupted in the simulator.

> **Question 1: Was this variable independent or repeated measures?** <select id="q1" onchange="checkAnswer('q1','A')"> <option value="">-- choose an answer --</option> <option value="A">A. Independent Measures</option> <option value="B">B. Repeated Measures</option></select>

During the driving simulation task, participants had to identify hazards (e.g., a car pulling out in front, or a pedestrian stepping out) by pressing a button. There were three different types of hazard that participants saw.

-   Independent variable 2 (hazard type: car, bike, pedestrian)

    -   Car: a car was the cause of the hazard.

    -   Bike: a bicycle was the cause of the hazard

    -   Pedestrian: a pedestrian was the cause of the hazard.

> **Question 2: Was this variable independent or repeated measures?** <select id="q2" onchange="checkAnswer('q2','B')"> <option value="">-- choose an answer --</option> <option value="A">A. Independent Measures</option> <option value="B">B. Repeated Measures</option></select>

The dependent variable in this study was the number of hazards correctly identified. The driving task was split into **two** blocks, and there were a maximum of 10 hazards for each hazard type in each block (total 30 hazards per block).

------------------------------------------------------------------------

**Workshop Outline**

The workshop is split into different parts:

**Exercises 1-2**: Import and Prepare Data for Analysis This will involve setting up RStudio, importing the data, and any data wrangling tasks to ensure the data is in the correct format prior to analysis.

**Exercise 3**: Calculate Statistics This will involve running initial descriptive statistics and the initial ANOVA model.

**Exercises 4-6** Carrying out any additional analyses (e.g., examine the interaction or interpret main effects) depending on the outcome of the initial ANOVA model.

**Exercise 7** Evaluate the model. This will be checking any necessary assumptions.

**Exercise 8** Generate publication worthy figures and write-up the results.

Let's begin...

## Exercise 1: Prepare RStudio and Import the Data

You'll need these packages:

``` r
library(tidyverse)
library(afex)
library(car)
library(emmeans)
library(effectsize)
```

Import the data set from the csv file called `hazard.csv`.

View the data to familiarise yourself with it:

-   `id`: the identifier.

-   `age`: participant age in years.

-   `exp_code`: was a code used to log in to the simulator experiment system for that participant.

-   `years_driving`: how many years they have been driving.

-   `distraction`: which distraction condition they were randomly assigned to.

-   `block1_car` and `block2_car`: the number of car hazards identified in blocks 1 and 2 respectively.

-   `block1_bike` and `block2_bike`: the number of bike hazards identified in blocks 1 and 2 respectively.

-   `block1_pedestrian` and `block2_pedestrian`: the number of pedestrian hazards identified in blocks 1 and 2 respectively.

## Exercise 2: Data Wrangling

The data set is a bit busier than what you have seen before, and requires some work before it is ready to analyse. This is a normal part of data analysis.

-   You need to calculate the total number of hazards correctly identified, because these are split over two blocks at the moment.

> **Question 3: Which R function could help with this?** <select id="q3" onchange="checkAnswer('q3','C')"> <option value="">-- choose an answer --</option> <option value="A">A. filter()</option> <option value="B">B. select()</option> <option value="C">C. mutate()</option> </select>

-   There are a few variables in the data set we don't really need, you could get rid of them to clean up the data set if you want.

> **Question 4: Which R function could help with this?** <select id="q4" onchange="checkAnswer('q4','B')"> <option value="">-- choose an answer --</option> <option value="A">A. filter()</option> <option value="B">B. select()</option> <option value="C">C. mutate()</option> </select>

-   The data has a repeated measures variable and this is in wide format currently. You will need long format data.

> **Question 5: Which R function could help with this?** <select id="q5" onchange="checkAnswer('q5','A')"> <option value="">-- choose an answer --</option> <option value="A">A. pivot_longer()</option> <option value="B">B. filter() </option> <option value="C">C. group_by()</option> </select>

**Calculate the Total Scores**

``` r
mydata <- mydata %>%
  mutate(car = block1_car + block2_car,
         bike = block1_bike + block2_bike,
         pedestrian = block1_pedestrian + block2_pedestrian)
```

This code will create three new variables: `car`, `bike`, and `pedestrian` to contain the sum of the two blocks. You used the `mutate()` function in week 1's workshop.

``` r
view(mydata)
```

Can you spot the new variables that you created?

**Select Relevant Variables**

Use `names(mydata)` for a list of the variables in the data set. Use the code below to select the variables you will need for your ANOVA analysis. You do not need everything in the original `mydata` data set.

For example, we really don't need the original `block1_` or `block2_` scores now we have the totals from above, and similarly, the `exp_code` is not needed for our analysis.

``` r
mydata_clean <- mydata %>%
  select(NULL, NULL, NULL, NULL) # add as many as necessary
```

Change each `NULL` to a variable you want to keep (each separated by a comma). You used the `select()` function in week 1's workshop. Note: this code creates a new object called `mydata_clean` so that we don't overwrite the original `mydata` object.

Use the hint below if needed.

------------------------------------------------------------------------

<details>

<summary>ðŸ‘€ Click for a hint</summary>

``` r
mydata_clean <- mydata %>%
  select(id, age, years_driving, distraction, car, bike, pedestrian)
```

</details>

------------------------------------------------------------------------

``` r
view(mydata_clean)
```

Do you notice that there are fewer variables in this data set? That looks a bit tidier!

**Convert from Wide to Long format**

``` r
longd <- mydata_clean %>%
  pivot_longer(
    cols = car:pedestrian,
    names_to = "hazard",
    values_to = "acc")
```

This will create two new labels: `hazard` for type of hazard, and `acc` for number of hazards correctly identified (accuracy). From now on you should use the `longd` object.

**Re-code Any Factors**

Last bit of wrangling. Make sure you have any factors coded as a Factor and not a character.

``` r
longd$distraction <- factor(longd$distraction)
longd$hazard <- factor(longd$hazard)
```

Now you are ready for the real analysis.

## Exercise 3: Descriptive Stats and the Model

Calculate descriptive statistics just like you have done in previous weeks.

Use `names(longd)` if you need a reminder of the variable names.

``` r
desc <- longd %>%
  group_by(NULL, NULL) %>%
    summarise(mean_acc = mean(NULL),
              sd_acc = sd(NULL))
view(desc)
```

You could also generate a box plot if you like (use code from previous weeks) but we will generate some visualisations later on.

Now to run the initial ANOVA model...

``` r
mod <- aov_ez(id = "NULL",
              dv = "NULL",
              within = "NULL",
              between = "NULL",
              type = 3,
              include_aov = TRUE,
              data = NULL)

mod$anova_table
```

Take extra care to ensure you enter the correct variable for the `within` and `between` lines of code. Look back over the study scenario section at the start of the workshop if you need.

Interpret the ANOVA model and decide what should happen next...

> **The first main effect (distraction) is** <select id="q6" onchange="checkAnswer('q6','B')"> <option value="">-- choose an answer --</option> <option value="A">Not significant</option> <option value="B"> Significant</option> </select>

> **The second main effect (hazard type) is** <select id="q7" onchange="checkAnswer('q7','B')"> <option value="">-- choose an answer --</option> <option value="A">Not significant</option> <option value="B"> Significant</option> </select>

> **The distraction by hazard type interaction is** <select id="q8" onchange="checkAnswer('q8','A')"> <option value="">-- choose an answer --</option> <option value="A">Not significant</option> <option value="B"> Significant</option> </select>

## Exercise 4: Interpreting the Main effect of Distraction

As there are only two levels, you can just use the mean values to interpret the direction. You can also use a box plot too.

``` r
m_distract <- longd %>%
  group_by(NULL) %>%
    summarise(mean_acc = mean(NULL),
              sd_acc = sd(NULL))
view(m_distract)

ggplot(longd, aes(x = distraction, y = acc)) +
  geom_boxplot() +
  theme_classic()
```

> **Question 9: Which statement is the correct interpretation of this main effect?** <select id="q9" onchange="checkAnswer('q9','B')"> <option value="">-- choose an answer --</option> <option value="A">A. Hazard perception was higher in the "distraction = Yes" condition </option> <option value="B">B. Hazard perception was higher in the "distraction = No" condition</option> </select>

## Exercise 5: Interpreting the Main Effect of Hazard Type

As there are more than two levels for this main effect, we cannot simply look at the means just yet, as it won't be clear which conditions are **significantly** different. All the main tell us is that **at least one** of them are significantly different, but which one?

Here you will need to follow the same steps as a one-way ANOVA (see Workshops 4 & 5 for a refresher). As the main effect was significant, in this scenario you will run post-hoc multiple comparisons to see how they differ. Work through the code below to figure out how to best interpret this main effect using:

1)  pairwise comparisons

2)  box plot for visualising data

3)  means and standard deviation descriptive statistics

``` r
emmeans(mod,
        pairwise ~ hazard,
        adjust = "holm")
```

``` r
ggplot(longd, aes(x = hazard, y = acc)) +
  geom_boxplot() +
  theme_classic()
```

``` r
m_hazard <- longd %>%
  group_by(hazard) %>%
  summarise(mean_acc = mean(acc),
            sd_acc = sd(acc))
view(m_hazard)
```

You have used the emmeans() function before in week 5's workshop. Interpret the output.

> **Question 10: Which was the only pair that was not significantly different?** <select id="q10" onchange="checkAnswer('q10','C')"> <option value="">-- choose an answer --</option> <option value="A">A. bike vs. car</option> <option value="B">B. car vs. pedestrian</option> <option value="C">C. bike vs. pedestrian</option> </select>

> **Question 11: Using all available information, which statement is NOT a correct interpretation of this main effect?** <select id="q11" onchange="checkAnswer('q11','B')"> <option value="">-- choose an answer --</option> <option value="A">A. Cars were easier to spot than bikes</option> <option value="B">B. Bikes were easier to spot than pedestrians</option> <option value="C">C. Cars were easier to spot than pedestrians</option> </select>

> **Question 12: Using all available information, which statement is the correct interpretation of this main effect?** <select id="q12" onchange="checkAnswer('q12','B')"> <option value="">-- choose an answer --</option> <option value="A">A. Pedestrians were significantly easier to spot than bikes</option> <option value="B">B. Bikes and pedestrians were spotted equally as often</option> <option value="C">C. Bikes were significantly easier to spot than pedestrians</option> </select>

## Exercise 6: Effect Sizes

So far you have the initial ANOVA model which give you:

-   *F*, df, and *p* for each main effect and the interaction.

Descriptive statistics for main effect of distraction which give you:

-   Mean and standard deviation of identified hazard for the two groups (yes, no for presence of distraction)

Descriptive statistics and pairwise comparisons for main effect of hazard type which give you:

-   Mean and standard deviation of identified hazards for the three conditions (car, bike, pedestrian for hazard type) and *t*, df, and *p* from pairwise comparisons between the three.

But what about effect sizes?

For the ANOVA model, you should look for partial eta squared ($Î·_P^2$). This is super quick and easy to check from the ANOVA model `mod` using this code:

``` r
eta_squared(mod)
```

You can report the full *F*-statement in APA format like this:

*F*([df1]{.underline}, [df2]{.underline}) = [value]{.underline}, *p* = [value]{.underline}, $Î·_P^2$ = [value]{.underline}

Anything underlined needs to be replaced by values from your output so far.

For the pairwise comparisons, it is a bit tricky as it depends if the variable for the main effect is an independent (between) or repeated (within) measures. If it is independent measures then follow the code from last week's workshop (see `cohens_d`).

As we have a repeated design we can use the same code as the *t*-test workshop earlier in term. \*\*One annoying this here is we need to go back and use the original `mydata` data as this is a rare occasion that wide data is preferred (how annoying, right?!)

``` r
cohens_d(mydata$car, mydata$bike, paired = TRUE)
cohens_d(mydata$car, mydata$pedestrian, paired = TRUE)
cohens_d(mydata$pedestrian, mydata$bike, paired = TRUE)
```

These need to match the three comparisons carried out in exercise 4.

> **Question 13: Which pairwise comparison had the largest effect size?** <select id="q11" onchange="checkAnswer('q11','A')"> <option value="">-- choose an answer --</option> <option value="A">A. Car vs. Pedestrian</option> <option value="B">B. Bike vs. Pedestrian</option> <option value="C">C. Car vs. Bike</option> </select>

## Exercise 7: Evaluating Assumptions

We need to evaluate two key assumptions for this design: Sphericity and Normality of Residuals.

### Sphericity

As we have a repeated measures independent variable with three levels, Sphericity applies. The good news is the initial ANOVA model checks this and automatically applies any correction. but with a caveat.

To check, produce the model output again but this time using `summary(mod)` as this gives us some extra information.

``` r
summary(mod)
```

If you look at the degrees of freedom, you'll notice these are a bit unusual as they're not whole numbers. `aov_ez()` will always apply the correction, whether we need it or not. How can we check if the assumption was violated?

Check the output:

``` r
                   Test statistic p-value
hazard                    0.96285 0.33993
distraction:hazard        0.96285 0.33993
```

As the p-values were not-significant this means that Sphericity was NOT violated and actually we could report the ANOVA model without the correction.

To report the assumption based on the output above, i'd write something like: > Mauchlyâ€™s test indicated that the assumption of sphericity was not violated for the main effect of hazard, *w* = .96, *p* = .340 or the distraction Ã— hazard interaction, *W* = .96 , *p* = .340.

This means the assumption of Sphericity was not violated.



<!-- JS to check correctness -->

```{=html}
<script>
function checkAnswer(id, correctValue){
  var el = document.getElementById(id);
  if(el.value === "") {
    el.style.backgroundColor = "";    // reset
    return;
  }
  if(el.value === correctValue){
    el.style.backgroundColor = "#b6f5b6";  // green
  } else {
    el.style.backgroundColor = "#f7b6b6";  // red
  }
}
</script>
```
